--- ghc-6.2/mk/package.mk.bak	Thu Nov 20 11:05:17 2003
+++ ghc-6.2/mk/package.mk	Wed Feb 18 13:30:00 2004
@@ -138,7 +138,7 @@
 ifneq "$(ALL_DIRS)" ""
 install ::
 	@for i in $(ALL_DIRS); do \
-		$(INSTALL_DIR) $(ifacedir)/$$i; \
+		$(INSTALL_DIR) $(DESTDIR)$(ifacedir)/$$i; \
 	done
 endif
 else
@@ -226,7 +226,7 @@
 	$(RM) -rf $(HTML_DIR)
 
 $(HTML_DOC) : $(HS_PPS)
-	@$(INSTALL_DIR) $(HTML_DIR)
+	@$(INSTALL_DIR) $(DESTDIR)$(HTML_DIR)
 	$(HADDOCK) $(HADDOCK_OPTS) -h -o $(HTML_DIR) $(HS_PPS) \
 		--package=$(PACKAGE) \
 		--dump-interface=$(PACKAGE).haddock \
@@ -243,12 +243,12 @@
 	$(GHC) $(HC_OPTS) -D__HADDOCK__ -E -cpp $< -o $<.tmp && sed -e 's/^#.*//' <$<.tmp >$@
 
 install-docs :: $(HTML_DOC)
-	@$(INSTALL_DIR) $(datadir)/html/libraries/$(PACKAGE)
+	@$(INSTALL_DIR) $(DESTDIR)$(datadir)/html/libraries/$(PACKAGE)
 	@for i in $(HTML_DIR)/*; do \
-	   echo $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(datadir)/html/libraries/$(PACKAGE); \
-	   $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(datadir)/html/libraries/$(PACKAGE); \
+	   echo $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(datadir)/html/libraries/$(PACKAGE); \
+	   $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(datadir)/html/libraries/$(PACKAGE); \
 	done
-	$(INSTALL_DATA) $(INSTALL_OPTS) $(PACKAGE).haddock $(datadir)/html/libraries/$(PACKAGE)
+	$(INSTALL_DATA) $(INSTALL_OPTS) $(PACKAGE).haddock $(DESTDIR)$(datadir)/html/libraries/$(PACKAGE)
 
 endif # HS_PPS
 endif # NO_HADDOCK_DOCS
--- ghc-6.2/mk/target.mk.bak	Wed Jul 23 17:25:32 2003
+++ ghc-6.2/mk/target.mk	Wed Feb 18 12:53:23 2004
@@ -605,13 +605,13 @@
 # on perl.
 #
 $(LINK) : $(LINK_TARGET)
-	@if ( $(PERL) -e '$$fn="$(LINK)"; exit ((! -f $$fn || -l $$fn) ? 0 : 1);' ); then \
-	   echo "Creating a symbolic link from $(LINK_TARGET) to $(LINK)"; \
-	   $(RM) $(LINK); \
-	   $(LN_S) $(LINK_TARGET) $(LINK); \
+	@if ( $(PERL) -e '$$fn="$(DESTDIR)$(LINK)"; exit ((! -f $$fn || -l $$fn) ? 0 : 1);' ); then \
+	   echo "Creating a symbolic link from $(LINK_TARGET) to $(DESTDIR)$(LINK)"; \
+	   $(RM) $(DESTDIR)$(LINK); \
+	   $(LN_S) $(LINK_TARGET) $(DESTDIR)$(LINK); \
 	 else \
-	   echo "Creating a symbolic link from $(LINK_TARGET) to $(LINK) failed: \`$(LINK)' already exists"; \
-	   echo "Perhaps remove \`$(LINK)' manually?"; \
+	   echo "Creating a symbolic link from $(LINK_TARGET) to $(DESTDIR)$(LINK) failed: \`$(DESTDIR)$(LINK)' already exists"; \
+	   echo "Perhaps remove \`$(DESTDIR)$(LINK)' manually?"; \
 	   exit 1; \
 	 fi;
 
@@ -620,14 +620,14 @@
 # install links to script drivers.
 #
 install ::
-	@$(INSTALL_DIR) $(bindir)
-	@if ( $(PERL) -e '$$fn="$(bindir)/$(LINK)"; exit ((! -f $$fn || -l $$fn) ? 0 : 1);' ); then \
-	   echo "Creating a symbolic link from $(LINK_TARGET) to $(LINK) in $(bindir)"; \
-	   $(RM) $(bindir)/$(LINK); \
-	   $(LN_S) $(LINK_TARGET) $(bindir)/$(LINK); \
+	@$(INSTALL_DIR) $(DESTDIR)$(bindir)
+	@if ( $(PERL) -e '$$fn="$(DESTDIR)$(bindir)/$(LINK)"; exit ((! -f $$fn || -l $$fn) ? 0 : 1);' ); then \
+	   echo "Creating a symbolic link from $(LINK_TARGET) to $(LINK) in $(DESTDIR)$(bindir)"; \
+	   $(RM) $(DESTDIR)$(bindir)/$(LINK); \
+	   $(LN_S) $(LINK_TARGET) $(DESTDIR)$(bindir)/$(LINK); \
 	 else \
-	   echo "Creating a symbolic link from $(LINK_TARGET) to $(LINK) in $(bindir) failed: \`$(bindir)/$(LINK)' already exists"; \
-	   echo "Perhaps remove \`$(bindir)/$(LINK)' manually?"; \
+	   echo "Creating a symbolic link from $(LINK_TARGET) to $(LINK) in $(DESTDIR)$(bindir) failed: \`$(DESTDIR)$(bindir)/$(LINK)' already exists"; \
+	   echo "Perhaps remove \`$(DESTDIR)$(bindir)/$(LINK)' manually?"; \
 	   exit 1; \
 	 fi;
 
@@ -671,10 +671,10 @@
 # from the installation itself.
 #
 install-dirs ::
-	@$(INSTALL_DIR) $(bindir)
-	@$(INSTALL_DIR) $(libdir)
-	@$(INSTALL_DIR) $(libexecdir)
-	@$(INSTALL_DIR) $(datadir)
+	@$(INSTALL_DIR) $(DESTDIR)$(bindir)
+	@$(INSTALL_DIR) $(DESTDIR)$(libdir)
+	@$(INSTALL_DIR) $(DESTDIR)$(libexecdir)
+	@$(INSTALL_DIR) $(DESTDIR)$(datadir)
 
 # Better do this first...
 # but we won't for the moment, do it on-demand from
@@ -695,10 +695,10 @@
 INSTALL_PROGS := $(foreach p, $(INSTALL_PROGS), $(addsuffix $(if $(suffix $(p)),,$(exeext)), $(basename $(p))))
 
 install:: $(INSTALL_PROGS)
-	@$(INSTALL_DIR) $(bindir)
+	@$(INSTALL_DIR) $(DESTDIR)$(bindir)
 	@for i in $(INSTALL_PROGS); do \
-		    echo $(INSTALL_PROGRAM) $(INSTALL_BIN_OPTS) $$i $(bindir); \
-		    $(INSTALL_PROGRAM) $(INSTALL_BIN_OPTS) $$i $(bindir) ;  \
+		    echo $(INSTALL_PROGRAM) $(INSTALL_BIN_OPTS) $$i $(DESTDIR)$(bindir); \
+		    $(INSTALL_PROGRAM) $(INSTALL_BIN_OPTS) $$i $(DESTDIR)$(bindir) ;  \
 	done
 endif
 
@@ -708,42 +708,42 @@
 #
 ifneq "$(INSTALL_SCRIPTS)" ""
 install:: $(INSTALL_SCRIPTS)
-	@$(INSTALL_DIR) $(bindir)
+	@$(INSTALL_DIR) $(DESTDIR)$(bindir)
 	for i in $(INSTALL_SCRIPTS); do \
-		$(INSTALL_SCRIPT) $(INSTALL_OPTS) $$i $(bindir); \
+		$(INSTALL_SCRIPT) $(INSTALL_OPTS) $$i $(DESTDIR)$(bindir); \
 	done
 endif
 
 ifneq "$(INSTALL_LIB_SCRIPTS)" ""
 install:: $(INSTALL_LIB_SCRIPTS)
-	@$(INSTALL_DIR) $(libdir)
+	@$(INSTALL_DIR) $(DESTDIR)$(libdir)
 	for i in $(INSTALL_LIB_SCRIPTS); do \
-		$(INSTALL_SCRIPT) $(INSTALL_OPTS) $$i $(libdir); \
+		$(INSTALL_SCRIPT) $(INSTALL_OPTS) $$i $(DESTDIR)$(libdir); \
 	done
 endif
 
 ifneq "$(INSTALL_LIBEXEC_SCRIPTS)" ""
 install:: $(INSTALL_LIBEXEC_SCRIPTS)
-	@$(INSTALL_DIR) $(libexecdir)
+	@$(INSTALL_DIR) $(DESTDIR)$(libexecdir)
 	for i in $(INSTALL_LIBEXEC_SCRIPTS); do \
-		$(INSTALL_SCRIPT) $(INSTALL_OPTS) $$i $(libexecdir); \
+		$(INSTALL_SCRIPT) $(INSTALL_OPTS) $$i $(DESTDIR)$(libexecdir); \
 	done
 endif
 
 ifneq "$(INSTALL_LIBS)" ""
 install:: $(INSTALL_LIBS)
-	@$(INSTALL_DIR) $(libdir)
+	@$(INSTALL_DIR) $(DESTDIR)$(libdir)
 	for i in $(INSTALL_LIBS); do \
 		case $$i in \
 		  *.a) \
-		    $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(libdir); \
-		    $(RANLIB) $(libdir)/`basename $$i` ;; \
+		    $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(libdir); \
+		    $(RANLIB) $(DESTDIR)$(libdir)/`basename $$i` ;; \
 		  *.dll) \
-		    $(INSTALL_DATA) -s $(INSTALL_OPTS) $$i $(libdir) ;; \
+		    $(INSTALL_DATA) -s $(INSTALL_OPTS) $$i $(DESTDIR)$(libdir) ;; \
 		  *.so) \
-		    $(INSTALL_SHLIB) $(INSTALL_OPTS) $$i $(libdir) ;; \
+		    $(INSTALL_SHLIB) $(INSTALL_OPTS) $$i $(DESTDIR)$(libdir) ;; \
 		  *) \
-		    $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(libdir); \
+		    $(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(libdir); \
 		esac; \
 	done
 endif
@@ -756,64 +756,64 @@
 INSTALL_LIBEXECS := $(foreach p, $(INSTALL_LIBEXECS), $(addsuffix $(subst _,,$(subst __,$(exeext),_$(suffix $(p))_)), $(basename $(p))))
 
 install:: $(INSTALL_LIBEXECS)
-	@$(INSTALL_DIR) $(libexecdir)
+	@$(INSTALL_DIR) $(DESTDIR)$(libexecdir)
 	-for i in $(INSTALL_LIBEXECS); do \
-		$(INSTALL_PROGRAM) $(INSTALL_BIN_OPTS) $$i $(libexecdir); \
+		$(INSTALL_PROGRAM) $(INSTALL_BIN_OPTS) $$i $(DESTDIR)$(libexecdir); \
 	done
 endif
 
 ifneq "$(INSTALL_DATAS)" ""
 install:: $(INSTALL_DATAS)
-	@$(INSTALL_DIR) $(datadir)
+	@$(INSTALL_DIR) $(DESTDIR)$(datadir)
 	for i in $(INSTALL_DATAS); do \
-		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(datadir); \
+		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(datadir); \
 	done
 endif
 
 ifneq "$(INSTALL_IFACES)" ""
 install:: $(INSTALL_IFACES)
-	@$(INSTALL_DIR) $(ifacedir)
+	@$(INSTALL_DIR) $(DESTDIR)$(ifacedir)
 	for i in $(INSTALL_IFACES); do \
-		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(ifacedir); \
+		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(ifacedir); \
 	done
 endif
 
 ifneq "$(INSTALL_IFACES_WITH_DIRS)" ""
 install:: $(INSTALL_IFACES_WITH_DIRS)
-	@$(INSTALL_DIR) $(ifacedir)
+	@$(INSTALL_DIR) $(DESTDIR)$(ifacedir)
 	for i in $(INSTALL_IFACES_WITH_DIRS); do \
-		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(ifacedir)/`dirname $$i`; \
+		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(ifacedir)/`dirname $$i`; \
 	done
 endif
 
 ifneq "$(INSTALL_INCLUDES)" ""
 install:: $(INSTALL_INCLUDES)
-	@$(INSTALL_DIR) $(includedir)
+	@$(INSTALL_DIR) $(DESTDIR)$(includedir)
 	for i in $(INSTALL_INCLUDES); do \
-		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(includedir); \
+		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(includedir); \
 	done
 endif
 
 ifneq "$(INSTALL_DOCS)" ""
 install-docs:: $(INSTALL_DOCS)
-	@$(INSTALL_DIR) $(datadir)	
+	@$(INSTALL_DIR) $(DESTDIR)$(datadir)	
 	for i in $(INSTALL_DOCS); do \
-		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(datadir); \
+		$(INSTALL_DATA) $(INSTALL_OPTS) $$i $(DESTDIR)$(datadir); \
 	done
 endif
 
 ifneq "$(INSTALL_SGML_DOC)" ""
 ifneq "$(SGMLDocWays)" ""
 install-docs:: $(foreach i,$(SGMLDocWays),$(INSTALL_SGML_DOC).$i)
-	@$(INSTALL_DIR) $(datadir)	
+	@$(INSTALL_DIR) $(DESTDIR)$(datadir)	
 	@for i in $(SGMLDocWays); do \
 		if [ $$i = "html" ]; then \
-			$(INSTALL_DIR) $(datadir)/html; \
-			echo $(CP) -r $(INSTALL_SGML_DOC) $(datadir)/html; \
-			$(CP) -r $(INSTALL_SGML_DOC) $(datadir)/html; \
+			$(INSTALL_DIR) $(DESTDIR)$(datadir)/html; \
+			echo $(CP) -r $(INSTALL_SGML_DOC) $(DESTDIR)$(datadir)/html; \
+			$(CP) -r $(INSTALL_SGML_DOC) $(DESTDIR)$(datadir)/html; \
 		else \
-			echo $(INSTALL_DATA) $(INSTALL_OPTS) $(INSTALL_SGML_DOC).$$i $(datadir); \
-			$(INSTALL_DATA) $(INSTALL_OPTS) $(INSTALL_SGML_DOC).$$i $(datadir); \
+			echo $(INSTALL_DATA) $(INSTALL_OPTS) $(INSTALL_SGML_DOC).$$i $(DESTDIR)$(datadir); \
+			$(INSTALL_DATA) $(INSTALL_OPTS) $(INSTALL_SGML_DOC).$$i $(DESTDIR)$(datadir); \
 		fi \
 	done
 endif
@@ -825,26 +825,26 @@
 uninstall:: 
 	@for i in $(INSTALL_PROGS) "" ; do			\
 	  if test "$$i"; then 					\
-		echo rm -f $(bindir)/`basename $$i`;		\
-		rm -f $(bindir)/`basename $$i`;			\
+		echo rm -f $(DESTDIR)$(bindir)/`basename $$i`;		\
+		rm -f $(DESTDIR)$(bindir)/`basename $$i`;			\
 	  fi; 							\
 	done
 	@for i in $(INSTALL_LIBS) ""; do			\
 	  if test "$$i"; then 					\
-		echo rm -f $(libdir)/`basename $$i`;		\
-		rm -f $(libdir)/`basename $$i`;			\
+		echo rm -f $(DESTDIR)$(libdir)/`basename $$i`;		\
+		rm -f $(DESTDIR)$(libdir)/`basename $$i`;			\
 	  fi;							\
 	done
 	@for i in $(INSTALL_LIBEXECS) ""; do			\
 	  if test "$$i"; then 					\
-		echo rm -f $(libexecdir)/`basename $$i`;	\
-		rm -f $(libexecdir)/`basename $$i`;		\
+		echo rm -f $(DESTDIR)$(libexecdir)/`basename $$i`;	\
+		rm -f $(DESTDIR)$(libexecdir)/`basename $$i`;		\
 	  fi;							\
 	done
 	@for i in $(INSTALL_DATAS) ""; do			\
 	  if test "$$i"; then 					\
-		echo rm -f $(datadir)/`basename $$i`;		\
-		rm -f $(datadir)/`basename $$i`;		\
+		echo rm -f $(DESTDIR)$(datadir)/`basename $$i`;		\
+		rm -f $(DESTDIR)$(datadir)/`basename $$i`;		\
 	  fi;							\
 	done
 
